# Introduction

This repository contains the pipeline and Shiny app from the paper "Untargeted Metabolomics of the Cavefish *Astyanax mexicanus* Reveals the Basis of Metabolic Strategies in Adaptation to Extreme Conditions".

# Required Software

* GHC 8.6.5 (or later) and Cabal 2.4.1.0 (or later)
 - Can be obtained from [ghcup](https://www.haskell.org/ghcup/).
* Python 3.8.3 or later (if running 3.9 or later see below)
* pipenv 2018.11.26 or later
 - Can usually be obtained by running `sudo pip install pipenv` or `conda install pipenv` if using Anaconda.
* R (specifically the `Rscript` command, which needs to be on the `PATH`) 3.6.3 or later with the `arm` package installed.

# Installing dependencies

First, install all required Python packages:

```
python3 -m pipenv install
```

Then install all required R packages:

```
Rscript -e "renv::restore()"
```

# Running the Pipeline

Run the following three commands:

```
cabal new-update
cabal new-build
cabal new-run pipeline
```

This will generate all figures under `out/fig`, and supplementary information under `out/supp`.

# Running the Shiny App

Be sure that you first run the pipeline (above), as the Shiny app requires datafiles generated by the pipeline.
The included `.Rprofile` file is links to an `renv` that contains all packages necessary for the app. Simply run

```
Rscript ./src/R/shiny/app.R
```

and point your browser to the appropriate port number (which will be displayed on the console).

# Notes

## Newer Python Versions (3.9+)

If running a newer version of Python, you may need to edit the Pipfile and change the line:

```
python_version = "3.8"
```

to (substitute your Python version)

```
python_version = "3.9"
```

However, some packages may not work with newer versions of Python or may have different behavior.

## Outliers

Most analyses produce outputs with and without the following outliers:

* Pachon Muscle Refed 5
* Tinaja Liver Refed 6
* Pachon Liver 30d Starved 3

Results including the outliers are in an `with-outliers` subdirectory whereas results excluding the outliers are in a `without-outliers` subdirectory. Most results from the paper exclude outliers.
